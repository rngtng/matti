<!DOCTYPE html>
<html>
  <head>
    <title>Matti's Supermarkt - Cartoons vom Wühltisch des Lebens</title>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="keywords"    content="catroons" />
    <meta name="description" content="Matti's Supermarkt Cartoons vom Wühltisch des Lebens" />
    <script language="php">
      $max_cartoons = iterator_count(new DirectoryIterator('cartoons/')) - 2;
      echo '<meta name="dynamic" content="true" data-max-cartoons="' . $max_cartoons . '">';
      echo '<base href="/">';
    </script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <style type="text/css">
      body {
        color: #000000;
        background-color: #FFFFFF;
        margin: 0;
      }

      img {
        display: block;
      }

      a {
        border: 0;
      }

      #main {
        padding-top: -40px;
        width: 841px;
        margin: 0 auto;
      }

      #footer a {
        color: #000;
        margin: 4px 15px;
      }
    </style>
    <script>
      var randomNr = function(max, exclude) {
        var nr = Math.floor(Math.random() * max) + 1;
        return (nr != exclude) ? nr : randomNr(max, exclude);
      },

      fillUpZeros = function(number, length) {
        var str = '' + number;
        while (str.length < length) {
          str = '0' + str;
        }
        return str;
      },

      cartoonUrl = function(nr) {
        return "cartoons/msm_cartoon_%04d.jpg".replace('%04d', fillUpZeros(nr, 4));
      },

      extractCartoonNr = function(string, maxCartoons) {
        if (url = string.match(/cartoons?[=\/](.+)/)) { return url[1]; }
      };

      $("#facebook").on("click", function(event) {
        var params = {
          app_id:       $(this).data('app-id'),
          link:         "http://rngtng.github.com/matti/?cartoon=" + cartoonNr,
          picture:      "http://rngtng.github.com/matti/" + cartoonUrl(cartoonNr),
          name:         "Matti's Supermarkt",
          caption:      "Cartoons vom Wühltisch des Lebens:",
          description:  "http://www.mattis-supermarkt.de",
          redirect_uri: "http://faceorama.warteschlange.de",
        };
        $(this).attr("href", function(index, url) {
          return url + "?" + $.param(params);
        });
      });

      $(document).ready(function(){
        var dynamic = ( $('meta[name=dynamic]').size() > 0),
        maxCartoons = parseInt($('meta[name=dynamic],body').data('maxCartoons'));

        cartoonNr = parseInt(extractCartoonNr(decodeURI(window.location.href)) || randomNr(maxCartoons));

        if(isNaN(cartoonNr) || cartoonNr < 1 || cartoonNr > maxCartoons) {
          window.location.assign('?');
        }

        $("#cartoon-frame").html('<img id="cartoon" width="530" height="376" src="' + cartoonUrl(cartoonNr) + '">');

        urlPattern = (dynamic) ? "/cartoons/" : "?cartoon=";
        $(".next").attr("href", urlPattern + randomNr(maxCartoons, cartoonNr));
      });
    </script>
  </head>
  <body alink="#EE0000" link="#0000EE" vlink="#551A8B" data-max-cartoons="95">
    <div id="main">
      <table border="0" cellpadding="0" cellspacing="0">
        <tbody>
          <tr>
            <td colspan="3" valign="bottom" width="841" height="218" background="images/header.jpg">
              <a href="#">
                <img width="841" height="218" src="images/blank.gif" border="0">
              </a>
            </td>
          </tr>
          <tr>
            <td valign="top" align="right" width="154" height="376" background="images/left.jpg">
              <a class="next" href=""><img width="154" height="376" src="images/blank.gif" border="0"></a>
            </td>
            <td id="cartoon-frame" valign="top" width="530" height="376" background="images/loading.gif">
              <script language="php">
                $cartoonUrl = sprintf("cartoons/msm_cartoon_%04d.jpg", $_GET['cartoon']);
                echo '<img id="cartoon" width="530" height="376" src="'.$cartoonUrl.'">';
              </script>
            </td>
            <td valign="top" align="left" width="157" height="376" background="images/right.jpg">
              <a id="facebook" href="https://www.facebook.com/dialog/feed" data-app-id="142898152440446" target="_blank">
                <img width="157" height="376" src="images/blank.gif" border="0">
              </a>
            </td>
          </tr>
          <tr>
            <td colspan="3" valign="top" width="841" height="43" background="images/footer.jpg">
              <img width="841" height="43" src="images/blank.gif" border="0">
            </td>
          </tr>
          <tr>
            <td id="footer" colspan="3" align="center">
              <small>
                <a class="next" href="#">zuf&auml;lliger Cartoon</a>
                <a href="#">Impressum</a>
                <a href="mailto:service@mattis-supermarkt.de">eMail</a>
              </small>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </body>
</html>
